{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Usu%C3%A1rio/Documents/trae_projects/NO%20PONTO/apps/web/src/app/mobile/MobileGeofenceMap.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef } from \"react\";\nimport { MapContainer, TileLayer, Marker, Circle, Popup } from \"react-leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport L from \"leaflet\";\n\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\",\n  iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\",\n  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\",\n});\n\ninterface MobileGeofenceMapProps {\n  employeeCoords: { lat: number; long: number; acc: number } | null;\n  workLocation?: {\n    latitude: number | null;\n    longitude: number | null;\n    radius?: number | null;\n  } | null;\n}\n\nexport default function MobileGeofenceMap({\n  employeeCoords,\n  workLocation,\n}: MobileGeofenceMapProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    const container = containerRef.current;\n\n    return () => {\n      if (container) {\n        const containers = container.getElementsByClassName(\"leaflet-container\");\n        Array.from(containers).forEach((element) => {\n          const anyElement: any = element;\n          if (anyElement && anyElement._leaflet_id) {\n            anyElement._leaflet_id = null;\n          }\n        });\n      }\n    };\n  }, []);\n\n  const defaultCenter: [number, number] = [-23.55052, -46.633309];\n\n  const workLat =\n    typeof workLocation?.latitude === \"number\" ? workLocation.latitude : null;\n  const workLng =\n    typeof workLocation?.longitude === \"number\" ? workLocation.longitude : null;\n\n  let center: [number, number] = defaultCenter;\n\n  if (workLat !== null && workLng !== null) {\n    center = [workLat, workLng];\n  } else if (employeeCoords) {\n    center = [employeeCoords.lat, employeeCoords.long];\n  }\n\n  const radius =\n    typeof workLocation?.radius === \"number\" && workLocation.radius > 0\n      ? workLocation.radius\n      : 50;\n\n  const hasEmployeePoint =\n    !!employeeCoords &&\n    typeof employeeCoords.lat === \"number\" &&\n    typeof employeeCoords.long === \"number\";\n\n  const hasWorkLocationPoint = workLat !== null && workLng !== null;\n\n  let distanceMeters: number | null = null;\n\n  if (hasEmployeePoint && hasWorkLocationPoint) {\n    const R = 6371e3;\n    const φ1 = (employeeCoords!.lat * Math.PI) / 180;\n    const φ2 = (workLat as number * Math.PI) / 180;\n    const Δφ = ((workLat as number - employeeCoords!.lat) * Math.PI) / 180;\n    const Δλ = ((workLng as number - employeeCoords!.long) * Math.PI) / 180;\n\n    const a =\n      Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +\n      Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2);\n\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n    distanceMeters = Math.round(R * c);\n  }\n\n  const distanceColor =\n    distanceMeters === null\n      ? \"text-slate-500\"\n      : distanceMeters < 10\n      ? \"text-green-600\"\n      : distanceMeters <= 50\n      ? \"text-yellow-600\"\n      : \"text-red-600\";\n\n  return (\n    <div ref={containerRef}>\n      <MapContainer\n        center={center}\n        zoom={15}\n        style={{ height: \"100%\", width: \"100%\" }}\n        scrollWheelZoom={false}\n      >\n        <TileLayer\n          attribution=\"&copy; OpenStreetMap contributors\"\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        {hasWorkLocationPoint && (\n          <>\n            <Circle\n              center={[workLat as number, workLng as number]}\n              radius={radius}\n              pathOptions={{\n                color: \"#16A34A\",\n                fillColor: \"#16A34A\",\n                fillOpacity: 0.15,\n              }}\n            />\n            <Marker position={[workLat as number, workLng as number]}>\n              <Popup>\n                <div className=\"text-xs\">\n                  <p className=\"font-semibold\">Posto de Trabalho</p>\n                  {typeof radius === \"number\" && (\n                    <p className=\"text-[11px] text-slate-500\">\n                      Raio configurado: {radius} m\n                    </p>\n                  )}\n                </div>\n              </Popup>\n            </Marker>\n          </>\n        )}\n        {hasEmployeePoint && (\n          <Marker position={[employeeCoords!.lat, employeeCoords!.long]}>\n            <Popup>\n              <div className=\"text-xs\">\n                <p className=\"font-semibold\">Sua posição aproximada</p>\n                {distanceMeters !== null && (\n                  <p className={`text-[11px] mt-1 ${distanceColor}`}>\n                    {distanceMeters} m do posto\n                  </p>\n                )}\n              </div>\n            </Popup>\n          </Marker>\n        )}\n      </MapContainer>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}